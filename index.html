<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lado C ‚Äì Una mirada distinta sobre la pol√≠tica</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      margin: 0;
      background: #f9f9f9;
      color: #333;
    }
    header {
      background: #101820;
      color: white;
      padding: 1rem 2rem;
      text-align: center;
    }
    .main-content {
      max-width: 1000px;
      margin: auto;
      padding: 1rem;
    }
    .article-card {
      background: white;
      margin: 1rem 0;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .article-card img {
      width: 100%;
      border-radius: 8px;
    }
    .article-content h3 {
      margin: 0.5rem 0;
    }
    .article-meta {
      font-size: 0.8rem;
      color: #777;
    }
    .read-more {
      background: #e63946;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.2s;
    }
    .read-more:hover {
      background: #c71c32;
    }
    .admin-panel {
      background: #fff;
      border: 1px solid #ccc;
      padding: 1rem;
      border-radius: 10px;
      margin: 1rem 0;
    }
    .notification {
      display: none;
      text-align: center;
      padding: 10px;
      color: white;
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      border-radius: 5px;
      z-index: 1000;
    }
    .notification.success { background: #4caf50; }
    .notification.error { background: #f44336; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <header>
    <h1>Lado C</h1>
    <p>Una mirada distinta sobre la pol√≠tica</p>
  </header>

  <div class="main-content">
    <div class="admin-panel" id="admin-panel">
      <h3>Panel de administraci√≥n</h3>
      <input id="article-title" placeholder="T√≠tulo" style="width:100%;margin:5px 0;">
      <input id="article-summary" placeholder="Resumen" style="width:100%;margin:5px 0;">
      <textarea id="article-content" placeholder="Contenido" style="width:100%;height:100px;margin:5px 0;"></textarea>
      <input id="article-image" placeholder="URL de imagen" style="width:100%;margin:5px 0;">
      <input id="article-author" placeholder="Autor" style="width:100%;margin:5px 0;">
      <select id="article-category" style="width:100%;margin:5px 0;">
        <option value="Opini√≥n">Opini√≥n</option>
        <option value="An√°lisis">An√°lisis</option>
        <option value="Entrevista">Entrevista</option>
      </select>
      <button onclick="saveArticle()">Guardar art√≠culo</button>
      <button onclick="clearArticleForm()">Limpiar</button>
    </div>

    <div id="articles-container"></div>
  </div>

  <div id="article-full-view" class="hidden"></div>

  <div id="notification" class="notification"></div>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = 'https://ygvuaitxfumdklfqkucj.supabase.co';
    const SUPABASE_KEY = 'TU_API_KEY_PUBLICA'; // üîπ reemplaz√° con tu clave p√∫blica
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    let articles = [];
    let currentArticleId = null;

    // üîπ Cargar art√≠culos
    async function loadArticles() {
      const { data, error } = await supabase
        .from('articles')
        .select('*')
        .order('id', { ascending: false });

      if (error) {
        console.error(error);
        showNotification('Error al cargar art√≠culos', 'error');
        return;
      }
      articles = data;
      renderArticles();
    }

    // üîπ Guardar o actualizar art√≠culo
    async function saveArticle() {
      const title = document.getElementById('article-title').value.trim();
      const summary = document.getElementById('article-summary').value.trim();
      const content = document.getElementById('article-content').value.trim();
      const image = document.getElementById('article-image').value.trim();
      const author = document.getElementById('article-author').value.trim() || "Redacci√≥n Lado C";
      const category = document.getElementById('article-category').value;
      const date = new Date().toLocaleDateString('es-AR');

      if (!title || !summary || !content) {
        showNotification('Por favor complet√° todos los campos', 'error');
        return;
      }

      const article = { title, summary, content, image, author, category, date };

      let error;
      if (currentArticleId) {
        ({ error } = await supabase.from('articles').update(article).eq('id', currentArticleId));
      } else {
        ({ error } = await supabase.from('articles').insert([article]));
      }

      if (error) {
        console.error(error);
        showNotification('Error al guardar', 'error');
      } else {
        showNotification('Art√≠culo guardado', 'success');
        clearArticleForm();
        await loadArticles();
      }
    }

    // üîπ Renderizar art√≠culos
    function renderArticles() {
      const container = document.getElementById('articles-container');
      container.innerHTML = '';
      if (articles.length === 0) {
        container.innerHTML = '<p style="text-align:center;">No hay art√≠culos publicados.</p>';
        return;
      }
      articles.forEach(a => {
        const div = document.createElement('div');
        div.className = 'article-card';
        div.innerHTML = `
          <img src="${a.image || 'https://via.placeholder.com/800x400'}">
          <div class="article-content">
            <h3>${a.title}</h3>
            <div class="article-meta">${a.date} | ${a.category} | ${a.author}</div>
            <p>${a.summary}</p>
            <button class="read-more" onclick="viewArticle(${a.id})">Leer m√°s</button>
            <button onclick="editArticle(${a.id})">Editar</button>
            <button onclick="deleteArticle(${a.id})">Eliminar</button>
          </div>`;
        container.appendChild(div);
      });
    }

    // üîπ Ver art√≠culo completo
    function viewArticle(id) {
      const article = articles.find(a => a.id === id);
      if (!article) return;
      const main = document.querySelector('.main-content');
      const full = document.getElementById('article-full-view');
      main.classList.add('hidden');
      full.classList.remove('hidden');
      full.innerHTML = `
        <div style="padding:1rem;">
          <button onclick="goBack()">&larr; Volver</button>
          <h2>${article.title}</h2>
          <p><em>${article.date} ‚Äì ${article.author}</em></p>
          <img src="${article.image || 'https://via.placeholder.com/800x400'}" style="width:100%;border-radius:8px;">
          <div style="margin-top:1rem;">${article.content}</div>
        </div>`;
      window.scrollTo(0,0);
    }

    function goBack() {
      document.querySelector('.main-content').classList.remove('hidden');
      document.getElementById('article-full-view').classList.add('hidden');
    }

    // üîπ Editar art√≠culo
    function editArticle(id) {
      const a = articles.find(x => x.id === id);
      if (!a) return;
      document.getElementById('article-title').value = a.title;
      document.getElementById('article-summary').value = a.summary;
      document.getElementById('article-content').value = a.content;
      document.getElementById('article-image').value = a.image;
      document.getElementById('article-author').value = a.author;
      document.getElementById('article-category').value = a.category;
      currentArticleId = a.id;
      showNotification('Editando art√≠culo...', 'info');
    }

    // üîπ Eliminar art√≠culo
    async function deleteArticle(id) {
      if (!confirm("¬øEliminar este art√≠culo?")) return;
      const { error } = await supabase.from('articles').delete().eq('id', id);
      if (error) {
        console.error(error);
        showNotification('Error al eliminar', 'error');
      } else {
        showNotification('Art√≠culo eliminado', 'success');
        await loadArticles();
      }
    }

    // üîπ Utilidades
    function clearArticleForm() {
      document.getElementById('article-title').value = '';
      document.getElementById('article-summary').value = '';
      document.getElementById('article-content').value = '';
      document.getElementById('article-image').value = '';
      document.getElementById('article-author').value = '';
      document.getElementById('article-category').value = 'Opini√≥n';
      currentArticleId = null;
    }

    function showNotification(msg, type='info') {
      const n = document.getElementById('notification');
      n.textContent = msg;
      n.className = `notification ${type}`;
      n.style.display = 'block';
      setTimeout(()=>n.style.display='none',3000);
    }

    // üîπ Iniciar
    window.onload = async () => {
      await loadArticles();
      showNotification('Conectado a Supabase', 'success');
    };
  </script>
</body>
</html>
